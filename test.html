<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&#9825;小倉唯楽曲一覧&#9825;</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        .pink-cell {
            background-color: pink;
        }

        th.sortable {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h2>&#9825;小倉唯楽曲一覧&#9825; <a href="tour.html">ツアーセットリスト比較ページ</a> <a href="my.html">未回収楽曲チェックツール</a> <a
            href="event.html">イベント検索ページ（ベータ版）</a></h2>
    <div class="radio-group">
        <div class="radio-button">
            <input type="radio" id="yui-solo" name="artist-filter" value="yui" checked>
            <label for="yui-solo">唯ソロ</label>

            <input type="radio" id="kaori-solo" name="artist-filter" value="kaori">
            <label for="kaori-solo">夏織ソロ</label>

            <input type="radio" id="yuikaori" name="artist-filter" value="yuikaori">
            <label for="yuikaori">ゆいかおり</label>
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th>楽曲名(クリックすると歌詞が開きます)</th>
                <th>コール表</th>
                <th>MV(抜け有)</th>
                <th>ライブ映像(抜け有)</th>
                <th class="sortable" data-sort="count">披露回数</th>
                <th class="sortable" data-sort="latestDate">最終披露日</th>
                <th>作詞</th>
                <th>作曲</th>
                <th>編曲</th>
                <th>長さ</th>
                <th>収録CD</th>
                <th>リリース日</th>
            </tr>
        </thead>
        <tbody id="songTable"></tbody>
    </table>

    <script>
        let originalSongs = []; // 元の順番を保持
        let currentSort = { field: null, direction: 'asc' }; // ソート状態

        function formatDateToJapanese(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString();
            const day = date.getDate().toString();
            return `${year}年${month}月${day}日`;
        }

        function sortSongs(songs, field, direction) {
            return [...songs].sort((a, b) => {
                const valA = a[field];
                const valB = b[field];

                if (field === 'latestDate' && valA && valB) {
                    return direction === 'asc' ? new Date(valA) - new Date(valB) : new Date(valB) - new Date(valA);
                }

                if (field === 'count') {
                    return direction === 'asc' ? valA - valB : valB - valA;
                }

                return 0; // 他のフィールドではソートしない
            });
        }

        function updateTable(songs) {
            const songTable = document.getElementById('songTable');
            songTable.innerHTML = ''; // Clear existing table rows

            songs.forEach(song => {
                const row = `
                    <tr>
                        <td><a href="https://www.uta-net.com/song/${song.utanet}">${song.title}</a></td>
                        <td>${song.call}</td>
                        <td>${song.MVlink}</td>
                        <td>${song.videolink}</td>
                        <td>${song.count}</td>
                        <td>${song.latestDate || '未披露'}</td>
                        <td>${song.lyrics}</td>
                        <td>${song.music}</td>
                        <td>${song.arranger}</td>
                        <td>${song.length}</td>
                        <td>${song.CDtitle}</td>
                        <td>${song.releaseDate}</td>
                    </tr>
                `;
                songTable.innerHTML += row;
            });
        }

        function updateSongDetails(selectedArtist) {
            fetch('song.json')
                .then(response => response.json())
                .then(songs => {
                    originalSongs = songs.filter(song => {
                        if (selectedArtist === 'yui') return song.artist === '小倉唯';
                        if (selectedArtist === 'kaori') return song.artist === '石原夏織';
                        if (selectedArtist === 'yuikaori') return song.artist === 'ゆいかおり';
                        return true;
                    });

                    updateTable(originalSongs);
                });
        }

        document.querySelectorAll('.sortable').forEach(header => {
            header.addEventListener('click', () => {
                const field = header.dataset.sort;
                const direction = currentSort.field === field && currentSort.direction === 'asc' ? 'desc' : 'asc';
                currentSort = { field, direction };

                const sortedSongs = currentSort.field ? sortSongs(originalSongs, field, direction) : originalSongs;
                updateTable(sortedSongs);
            });
        });

        document.getElementsByName('artist-filter').forEach(filter => {
            filter.addEventListener('change', () => {
                updateSongDetails(filter.value);
            });
        });

        updateSongDetails('yui'); // 初期呼び出し
    </script>
</body>

</html>
